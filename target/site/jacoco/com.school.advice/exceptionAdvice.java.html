<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ru"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>exceptionAdvice.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">MobileOperatorJavaSchoolT Maven Webapp</a> &gt; <a href="index.source.html" class="el_package">com.school.advice</a> &gt; <span class="el_source">exceptionAdvice.java</span></div><h1>exceptionAdvice.java</h1><pre class="source lang-java linenums">package com.school.advice;

import com.school.customException.ServiceLayerException;
import org.apache.log4j.Level;
import org.springframework.web.bind.annotation.ControllerAdvice;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.apache.log4j.Logger;
import org.springframework.web.servlet.mvc.support.RedirectAttributes;
import org.springframework.web.servlet.view.RedirectView;


import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import java.io.IOException;
import java.security.Principal;
import java.util.Map;

/**
 * This advice handle different types of exceptions
 * It registers and handle them
 */
@ControllerAdvice
<span class="nc" id="L23">public class exceptionAdvice {</span>

<span class="nc" id="L25">    private static final Logger LOG = Logger.getLogger(exceptionAdvice.class);</span>


    /**
     * This handler catches all exceptions which doesn't handle somewhere in code
     * @param e exception
     * @return redirect to page with error message
     */
    @ExceptionHandler(Exception.class)
    public String handleException(Exception e) {
<span class="nc" id="L35">        LOG.setLevel(Level.ERROR);</span>
<span class="nc" id="L36">        LOG.error(e.getMessage());</span>
<span class="nc" id="L37">        return &quot;redirect:/errorPage?errorMes=&quot; + e.getMessage();</span>
    }

    /**
     * This handler catches errors which hava been found on the service layer
     * @param e exception with message
     * @param principal user's data
     * @param request servlet request
     * @param redir constructor for redirect arguments
     * @return view with data and exception message text
     * @throws ServletException
     * @throws IOException
     */
    @ExceptionHandler(ServiceLayerException.class)
    public RedirectView handleServiceException(ServiceLayerException e, Principal principal,
                                               HttpServletRequest request, RedirectAttributes redir) throws ServletException, IOException {

<span class="nc" id="L54">        LOG.setLevel(Level.ERROR);</span>
<span class="nc" id="L55">        LOG.error(&quot;User &quot; + principal.getName() + &quot; &quot; + e.getMessage());</span>
<span class="nc" id="L56">        RedirectView redirectView = new RedirectView(request.getHeader(&quot;Referer&quot;), true);</span>
<span class="nc" id="L57">        redir.addFlashAttribute(&quot;errorMessage&quot;, e.getMessage());</span>
<span class="nc" id="L58">        Map&lt;String, String[]&gt; pageData = request.getParameterMap();</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">        for(String key : pageData.keySet()) {</span>
<span class="nc" id="L60">            redir.addFlashAttribute(key, pageData.get(key)[0]);</span>
<span class="nc" id="L61">        }</span>
<span class="nc" id="L62">        return redirectView;</span>
    }


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>